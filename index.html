<head>
  <title>A-Frame Meets Daydream</title>
  <meta name="description" content="A tale of a WebVR framework and a VR controller.">
  <script src="https://aframe.io/releases/0.4.0/aframe.min.js"></script>
  <script src="/aframe-daydream-controller-component.js"></script>
  <script src="/world-position.js"></script>
</head>

<body>
  <a-scene>
    <a-entity position="-0.2 1.3 0">
      <a-entity id="remote" daydream-controller raycaster="objects: .selectable">
        <a-cone id="ray" color="cyan" position="0 0 -2" rotation="-90 0 0" radius-bottom="0.005" radius-top="0.001" height="4"></a-cone>
        <a-sphere id="position-guide" radius="0.05" position="0 0 -4"></a-sphere>
      </a-entity>
    </a-entity>
    <a-box id="ground" class="selectable" color="green" depth="100" height="0.1" width="100" position="0 -0.05 0"></a-box>
    <a-box id="box" class="selectable" material="color:orange; shader: flat" position="0 1 -4"></a-box>
    <a-sky color="blue"></a-sky>
  </a-scene>

  <script>
    var remote = document.querySelector('#remote');
    var box = document.querySelector('#box');
    var ground = document.querySelector('#ground');
    var ray = document.querySelector('#ray');
    var sphere = document.querySelector('#position-guide');
    var intersection;
    var touchStartAxes;
    var minScale = 0.1;
    var scaleMultiplier = 1;
    var newScale = currentScale = 1;
    var focused = false;

    // ground color change
    ground.addEventListener('raycaster-intersected', function (e) {
      focused = true;
      // console.log(e.detail.intersection.distance);
      intersection = e.detail.intersection.point;
    });
    ground.addEventListener('raycaster-intersected-cleared', function () {
      focused = false;
      ground.setAttribute('color','green');
    })

    // trackpad to scale
    remote.addEventListener('axismove', function (e) {
      if (!touchStartAxes) return;
      var deltaX = e.detail.axis[0] - touchStartAxes[0];
      newScale = currentScale + deltaX*scaleMultiplier;
      if (newScale < minScale) newScale = minScale;
      box.setAttribute('scale',newScale+' '+newScale+' '+newScale);
    });
    remote.addEventListener('touchstart', function (e) {
      touchStartAxes = e.detail.axis;
    });
    remote.addEventListener('touchend', function (e) {
      touchStartAxes = null;
      currentScale = newScale;
    });
    remote.addEventListener('buttondown', function (e) {
      if (focused) {
        console.log(intersection);
      } else {
        box.setAttribute('color','orange');
      }
    });
    // remote.addEventListener('buttonup', function (e) {
    //   if (focused) {
    //     box.setAttribute('color','purple');
    //   } else {
    //     box.setAttribute('color','orange');
    //   }
    // });
  </script>
</body>
